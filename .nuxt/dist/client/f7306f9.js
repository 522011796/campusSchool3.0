(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{1363:function(t,e,n){var content=n(1633);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(31).default)("4fd15fb4",content,!0,{sourceMap:!1})},1632:function(t,e,n){"use strict";var o=n(1363);n.n(o).a},1633:function(t,e,n){(e=n(30)(!1)).push([t.i,".container[data-v-c0ae1296]{padding:10px 15px}.news-img[data-v-c0ae1296]{height:50px;width:50px}",""]),t.exports=e},2016:function(t,e,n){"use strict";n.r(e);n(360),n(65),n(106),n(710),n(53);var o=n(9),l=n(76),r=n(1261),c=n(1257),d=n(234),f=n(235),h=n(1260),m=n(1268),v=n(236),y=n(7),_=n(6),w=n(1286),D=n(1287),C=n(1288),$=n(1269),x=n(1289),P=n(1306),k=n(1256),T={mixins:[l.a,P.a],components:{MySelect:k.default,MyRadio:$.default,LayoutTb:r.default,MyInputButton:c.default,MyPagination:d.default,DialogNormal:f.default,MyNormalDialog:h.default,DrawerRight:m.default,DrawerLayoutRight:v.default,MyFlowType:w.default,MyFlowCondition:D.default,MyFlowProcess:C.default,MyFlowProcessList:x.default},data:function(){return{modalVisible:!1,drawerVisible:!1,visibleConfim:!1,dialogLoading:!1,loading:!1,drawerLoading:!1,subTitle:"",uploadFile:y.a.upload_file,uploadResult:{},uploadProcess:"",g_superId:"",searchKey:"",tableData:[],errorTips:"",listData:[],addStatus:"",form:{id:"",name:"",content:"",conditionType:"",conditionDay1:"",conditionDay2:"",status:!0,handleProcess:[]}}},created:function(){this.initInfo()},methods:{initInfo:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getSessionInfo();case 2:t.init();case 3:case"end":return e.stop()}}),e)})))()},init:function(){var t=this,e={page:this.page,num:this.num,applyTypeCode:"PunishmentApply",name:this.searchKey};this.$axios.get(y.a.flow_center_page,{params:e}).then((function(e){e.data.data&&(t.tableData=e.data.data.list,t.total=e.data.data.totalCount,t.num=e.data.data.num,t.page=e.data.data.currentPage)}))},initPunishment:function(){var t=this,e={page:1,num:9999};e=this.$qs.stringify(e),this.$axios.post(y.a.audit_re_level,e).then((function(e){if(e.data.data){for(var i=0;i<e.data.data.list.length;i++)e.data.data.list[i].label=e.data.data.list[i].level_name,e.data.data.list[i].value=e.data.data.list[i].level_name;t.listData=e.data.data.list}}))},addInfo:function(){this.initPunishment(),"edit"==this.addStatus&&this.clearDrawerDialog(),this.drawerVisible=!0},editInfo:function(t){this.addStatus="edit",this.form={id:t.id,name:t.name,content:t.des,conditionType:"",conditionDay1:"",conditionDay2:"",status:t.enable,handleProcess:[]};for(var e=t.handle_condition,i=0;i<e.length;i++)"proLevel"==e[i].type&&(this.form.conditionType=e[i].value1);for(var n=t.handle_process,o=0;o<n.length;o++){for(var l=n[o].hname?n[o].hname.split(","):[],r=n[o].nid?n[o].nid.split(","):[],c=[],d=0;d<l.length;d++)c.push({user_id:l[d].split("@*@")[0],real_name:l[d].split("@*@")[1]});this.form.handleProcess.push({type:n[o].htype,audit:c,auditName:l,share:r,notice:n[o].andor})}this.initPunishment(),this.drawerVisible=!0},deleteInfo:function(t){this.form.id=t.id,this.subTitle=t.name,this.visibleConfim=!0},cancelDialog:function(){this.modalVisible=!1},cancelDrawDialog:function(){this.clearDrawerDialog(),this.drawerVisible=!1},closeDialog:function(t){},clearDrawerDialog:function(){this.form={id:"",name:"",content:"",conditionType:"",conditionDay1:"",conditionDay2:"",status:!0,handleProcess:[]},this.$refs.form&&this.$refs.form.resetFields(),this.$refs.flowProcessRef&&this.$refs.flowProcessRef._handleResetChange(),this.errorTips="",this.addStatus=""},closeDrawerDialog:function(t){this.drawerVisible=t},handleCloseDrawer:function(){this.form={id:"",name:"",content:"",conditionType:"",conditionDay1:"",conditionDay2:"",status:!0,handleProcess:[]},this.$refs.form&&this.$refs.form.resetFields(),this.$refs.flowProcessRef&&this.$refs.flowProcessRef._handleResetChange()},closeDrawDialog:function(t){this.drawerVisible=!1},okDrawDialog:function(t){var e=this,n="";this.errorTips="";var o=0;this.$refs.form.validate((function(t){if(t){var l={applyTypeCode:"PunishmentApply",des:e.form.content,enable:e.form.status,name:e.form.name};l.handleConditions=[{type:"proLevel",value1:e.form.conditionType}];for(var r=e.$refs.flowProcessRef._getFlowProcessData(),c=[],i=0;i<r.length;i++){for(var d=[],f=[],h=[],m=0;m<r[i].audit.length;m++)d.push(r[i].audit[m].user_id);for(var v=0;v<r[i].auditName.length;v++)h.push(r[i].auditName[v]);for(var w=0;w<r[i].share.length;w++)f.push(r[i].share[w].user_id);c.push({horder:i,htype:r[i].type,hid:d.join(),hname:h.join(),nid:f.join(),andor:r[i].notice}),"AnyUser"==r[i].type&&0==d.length&&o++}if(o>0)return void Object(_.c)("请设置固定教师中的审批教师");l.handleProcess=c,""!=e.form.id&&(l.id=e.form.id),n=y.a.flow_center_update,e.drawerLoading=!0,e.$axios.post(n,l,{dataType:"stringfy"}).then((function(t){200==t.data.code?(e.drawerVisible=!1,e.init(),e.clearDrawerDialog(),Object(_.b)(t.data.desc)):Object(_.a)(t.data.desc),e.drawerLoading=!1}))}}))},handleOkChange:function(data){var t=this;this.dialogLoading=!0;var e={id:this.form.id};e=this.$qs.stringify(e),this.$axios.post(y.a.flow_center_del,e).then((function(e){200==e.data.code?(t.init(),t.form.id="",Object(_.b)(e.data.desc)):Object(_.a)(e.data.desc),t.visibleConfim=!1,t.dialogLoading=!1}))},handleCancelChange:function(data){this.visibleConfim=!1},search:function(t){this.page=1,this.searchKey=t.input,this.init()},sizeChange:function(t){this.page=1,this.num=t,this.init()},currentPage:function(t){this.page=t,this.init()},jumpPage:function(data){this.page=data,this.init()},handleChange:function(t){this.form.conditionType=t},changeStatus:function(t,data){this.form.status=data},handleChangeSelect:function(data){this.form.conditionType=data}}},M=(n(1632),n(10)),component=Object(M.a)(T,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("layout-tb",[n("template",{slot:"tag"},[t._v("学生奖惩申请")]),t._v(" "),n("div",{attrs:{slot:"tab"},slot:"tab"},[n("el-row",[n("el-col",{attrs:{span:12}},[n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(e){return t.addInfo(e)}}},[t._v(t._s(t.$t("添加流程")))])],1),t._v(" "),n("el-col",{staticClass:"text-right",attrs:{span:12}},[n("my-input-button",{attrs:{size:"small",plain:"","width-class":"width: 150px",type:"success",clearable:!0,placeholder:t.$t("名称")},on:{click:t.search}})],1)],1)],1),t._v(" "),n("div",{attrs:{slot:"content"},slot:"content"},[n("el-table",{ref:"refTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"header-cell-class-name":"custom-table-cell-bg",size:"medium","max-height":t.tableHeight.height}},[n("el-table-column",{attrs:{align:"center",label:t.$t("日期")},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[n("div",{staticClass:"text-center"},[t._v(t._s(t.$moment(e.row.add_time).format("YYYY-MM-DD HH:mm")))]),t._v(" "),n("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[t._v("\n                "+t._s(t.$moment(e.row.add_time).format("YYYY-MM-DD HH:mm"))+"\n              ")])])]}}])}),t._v(" "),n("el-table-column",{attrs:{align:"center",label:t.$t("流程名称")},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[n("div",{staticClass:"text-center"},[t._v(t._s(e.row.name?e.row.name:"--"))]),t._v(" "),n("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[t._v("\n                "+t._s(e.row.name?e.row.name:"--")+"\n              ")])])]}}])}),t._v(" "),n("el-table-column",{attrs:{align:"center",prop:"department_no",label:t.$t("申请类型")},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[n("div",{staticClass:"text-center"},[n("my-flow-type",{attrs:{status:e.row.apply_type_code}})],1),t._v(" "),n("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[n("my-flow-type",{attrs:{status:e.row.apply_type_code}})],1)])]}}])}),t._v(" "),n("el-table-column",{attrs:{align:"center",prop:"department_no",label:t.$t("条件")},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[n("div",{staticClass:"text-center"},[n("my-flow-condition",{attrs:{condition:e.row.handle_condition,"condition-type-code":e.row.apply_type_code}})],1),t._v(" "),n("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[n("my-flow-condition",{attrs:{condition:e.row.handle_condition,"condition-type-code":e.row.apply_type_code}})],1)])]}}])}),t._v(" "),n("el-table-column",{attrs:{align:"center",prop:"department_no",label:t.$t("流程"),width:"200"},scopedSlots:t._u([{key:"default",fn:function(t){return[n("my-flow-process",{attrs:{process:t.row.handle_process}})]}}])}),t._v(" "),n("el-table-column",{attrs:{align:"center",prop:"department_no",label:t.$t("备注")},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[n("div",{staticClass:"text-center"},[n("span",[t._v(t._s(e.row.des?e.row.des:"--"))])]),t._v(" "),n("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[n("span",[t._v(t._s(e.row.des?e.row.des:"--"))])])])]}}])}),t._v(" "),n("el-table-column",{attrs:{align:"center",prop:"department_no",label:t.$t("状态")},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.enable?n("span",{staticClass:"color-success"},[t._v(t._s(t.$t("启用")))]):n("span",{staticClass:"color-warning"},[t._v(t._s(t.$t("禁用")))])]}}])}),t._v(" "),n("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("i",{staticClass:"fa fa-edit color-grand margin-right-5",on:{click:function(n){return t.editInfo(e.row)}}}),t._v(" "),n("i",{staticClass:"fa fa-trash color-danger",on:{click:function(n){return t.deleteInfo(e.row)}}})]}}])})],1),t._v(" "),n("div",{staticClass:"layout-right-footer text-right"},[n("my-pagination",{staticClass:"layout-pagination",attrs:{total:t.total,"current-page":t.page,"page-size":t.num},on:{currentPage:t.currentPage,sizeChange:t.sizeChange,jumpChange:t.jumpPage}})],1)],1)],2),t._v(" "),n("drawer-layout-right",{attrs:{tabindex:"0","hide-footer":!1,visible:t.drawerVisible,size:"650px",title:t.$t("流程设置")},on:{changeDrawer:t.closeDrawerDialog,"right-close":t.cancelDrawDialog}},[n("div",{attrs:{slot:"content"},slot:"content"},[n("span",{attrs:{tabindex:"1"}}),t._v(" "),n("el-form",{ref:"form",attrs:{rules:t.rules,model:t.form,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"申请类型"}},[n("label",{staticClass:"color-success"},[t._v(t._s(t.$t("学生奖惩申请")))])]),t._v(" "),n("el-form-item",{attrs:{label:"名称",prop:"name"}},[n("el-input",{staticClass:"width-300",model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"备注"}},[n("el-input",{staticClass:"width-300",model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"条件",prop:"conditionType"}},[n("my-select",{attrs:{"width-style":"300","sel-value":t.form.conditionType,options:t.listData},on:{change:function(e){return t.handleChangeSelect(e)}}})],1),t._v(" "),n("el-form-item",{attrs:{label:"状态"}},[n("my-radio",{attrs:{"sel-value":t.form.status,label:!0},on:{change:function(e){return t.changeStatus(e,!0)}}},[t._v(t._s(t.$t("启用")))]),t._v(" "),n("my-radio",{attrs:{"sel-value":t.form.status,label:!1},on:{change:function(e){return t.changeStatus(e,!1)}}},[t._v(t._s(t.$t("禁用")))])],1),t._v(" "),n("el-form-item",{attrs:{label:"流程"}},[n("my-flow-process-list",{ref:"flowProcessRef",attrs:{"process-data":t.form.handleProcess,"width-style":"200"}})],1)],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("div",{staticClass:"text-right padding-lr-10"},[n("el-button",{attrs:{size:"small"},on:{click:t.cancelDrawDialog}},[t._v(t._s(t.$t("取消")))]),t._v(" "),n("el-button",{attrs:{size:"small",type:"primary",loading:t.drawerLoading},on:{click:t.okDrawDialog}},[t._v(t._s(t.$t("发布")))])],1)])]),t._v(" "),n("my-normal-dialog",{attrs:{visible:t.visibleConfim,loading:t.dialogLoading,title:"提示",content:"确认需要删除该信息？",detail:t.subTitle},on:{"update:visible":function(e){t.visibleConfim=e},"ok-click":t.handleOkChange,"cancel-click":t.handleCancelChange,close:t.closeDialog}})],1)}),[],!1,null,"c0ae1296",null);e.default=component.exports;installComponents(component,{MyInputButton:n(1257).default,MyFlowType:n(1286).default,MyFlowCondition:n(1287).default,MyFlowProcess:n(1288).default,MyPagination:n(234).default,LayoutTb:n(1261).default,MySelect:n(1256).default,MyRadio:n(1269).default,MyFlowProcessList:n(1289).default,DrawerLayoutRight:n(236).default,MyNormalDialog:n(1260).default})}}]);