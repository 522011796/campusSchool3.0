(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{1417:function(t,e,n){var content=n(1742);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(31).default)("3595f9e4",content,!0,{sourceMap:!1})},1741:function(t,e,n){"use strict";var o=n(1417);n.n(o).a},1742:function(t,e,n){(e=n(30)(!1)).push([t.i,".container[data-v-ad0696d4]{padding:10px 15px}.setting-td[data-v-ad0696d4]{height:100%;width:100%;font-size:12px;position:relative}.setting-icon[data-v-ad0696d4]{height:25px;width:25px;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)}",""]),t.exports=e},1979:function(t,e,n){"use strict";n.r(e);n(108),n(65),n(106),n(710),n(53);var o,l=n(9),r=n(104),c=n(234),d=n(76),m=n(7),f=n(6),h=n(1261),_=n(1256),v=n(1273),y=n(1258),k=n(1257),C=n(235),T=n(1312),$=n(1276),w=n(1313),x=n(1314),D=n(86),I=n.n(D),L={data:function(){return{rules:{name:[{required:!0,message:this.$t("请输入名称"),trigger:"blur"},{validator:I.a.FormValidate.Form().validatenall1_20Reg,trigger:"blur"}],dormitoryIdList:[{required:!0,type:"array",min:1,message:this.$t("请选择信息"),trigger:"change"}],delay:[{required:!0,message:this.$t("请输入信息"),trigger:"blur"},{validator:I.a.FormValidate.Form().validateNumber,trigger:"blur"}]}}}},S={mixins:[d.a,L],components:(o={DormBuildTreeAndList:w.default,MyCheck:$.default,MyPagination:c.default,LayoutTb:h.default,MySelect:_.default,MyUserType:v.default,MyDatePicker:y.default,MyInputButton:k.default,DialogNormal:C.default,ClassroomTreeAndList:T.default},Object(r.a)(o,"MyCheck",$.default),Object(r.a)(o,"MySelect",_.default),Object(r.a)(o,"DormBuildTreeAndList",w.default),Object(r.a)(o,"StudentTreeAndList",x.default),o),data:function(){return{tableData:[],tableSettingData:[],searchDate:[],typeList:[],sectionList:[],tableDayInfo:[],searchKey:"",visible:!1,modalVisible:!1,dialogLoading:!1,visibleConfim:!1,modalOtherVisible:!1,clearTime:"",action:"",subTitle:"",errorTips:"",tips:"",form:{id:"",name:"",startTime:"",endTime:"",delay:60,dormitoryIdList:[],checkbedRuleDay:[]}}},created:function(){this.init()},methods:{init:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.initPage();case 1:case"end":return e.stop()}}),e)})))()},initPage:function(){var t=this,e={page:this.page,num:this.num,rullType:10};this.$axios.get(m.a.attend_dorm_setting_page,{params:e}).then((function(e){e.data.data&&(t.tableData=e.data.data.list,t.total=e.data.data.totalCount,t.num=e.data.data.num,t.page=e.data.data.currentPage)}))},initSetting:function(t){var e=this,n={};t&&(n={checkbedRuleId:t.id}),this.$axios.get(m.a.attend_dorm_setting_info,{params:n}).then((function(t){t.data.data&&(e.tableDayInfo=t.data.data)}))},addInfo:function(){this.initSetting(),this.modalVisible=!0},syncInfo:function(){this.oprType="sync",this.tips=this.$t("当天已考勤数据会被全部删除，是否确认？"),this.visibleConfim=!0},otherInfo:function(){this.modalOtherVisible=!0},editInfo:function(t){var e=t.user_id_list?t.user_id_list.split(","):[],n=[];this.form={id:t.id,name:t.name,startTime:t.start_time,endTime:t.end_time,delay:t.delay,checkbedRuleDay:[]};for(var i=0;i<e.length;i++)n.push({user_id:e[i]});this.$set(this.form,"dormitoryIdList",n),this.initSetting(t),this.modalVisible=!0},resetInfo:function(t){this.oprType="reset",this.form.id=t.id,this.subTitle=t.name,this.tips=this.$t("确认需要重置时间吗？"),this.visibleConfim=!0},search:function(data){this.searchKey=data.input,this.page=1,this.init()},sizeChange:function(t){this.page=1,this.num=t,this.init()},currentPage:function(t){this.page=t,this.init()},jumpPage:function(data){this.page=data,this.init()},handleSelect:function(data){this.form.type=data},deleteInfo:function(t){this.oprType="del",this.form.id=t.id,this.subTitle=t.name,this.tips="确认需要删除该信息？",this.visibleConfim=!0},handleOkChange:function(data){var t=this;this.dialogLoading=!0;var e="",n={};"del"==this.oprType?(n={id:this.form.id},e=m.a.attend_dorm_setting_delete):"reset"==this.oprType?(n={id:this.form.id},e=m.a.attend_dorm_setting_clear):"sync"==this.oprType&&(e=m.a.attend_dorm_setting_sync),n=this.$qs.stringify(n),"sync"==this.oprType?this.$axios.get(e,n).then((function(e){200==e.data.code?(t.init(),Object(f.b)(e.data.desc)):Object(f.a)(e.data.desc),t.visibleConfim=!1,t.dialogLoading=!1})):this.$axios.post(e,n).then((function(e){200==e.data.code?(t.init(),Object(f.b)(e.data.desc)):Object(f.a)(e.data.desc),t.visibleConfim=!1,t.dialogLoading=!1}))},handleCancelChange:function(data){this.visibleConfim=!1},cancelDialog:function(){this.modalVisible=!1},closeDialog:function(t){this.form={id:"",name:"",startTime:"",endTime:"",delay:60,dormitoryIdList:[],checkbedRuleDay:[]},this.subTitle="",this.oprType,this.$refs.popverPartRef&&this.$refs.popverPartRef._handleResetChange(),this.$refs.form&&this.$refs.form.resetFields()},okDialog:function(t){var e=this,n="",o=this,l=[],r=[];this.errorTips="",this.$refs.form.validate((function(t){if(t){e.dialogLoading=!0;var c={checkbedRuleDay:e.form.checkbedRuleDay,delay:e.form.delay,endTime:e.form.endTime,name:e.form.name,startTime:e.form.startTime};if(e.tableDayInfo.map((function(t,e){t&&t.days.map((function(t,e){t&&r.push({busiTime:t.busiTime,weekNum:t.weekNum,weekNo:t.weekNo,rollCall:t.rollCall,festival:t.festival,checkbedRuleId:o.form.id})}))})),c.checkbedRuleDay=r,e.form.dormitoryIdList.length>0){for(var i=0;i<e.form.dormitoryIdList.length;i++)l.push(e.form.dormitoryIdList[i].user_id);c.userIdList=l}""!=e.form.id?(c.id=e.form.id,n=m.a.attend_dorm_setting_edit):(n=m.a.attend_dorm_setting_add,c.rullType=10),e.$axios.post(n,JSON.stringify(c),{dataType:"stringfy",loading:!1}).then((function(t){200==t.data.code?(e.modalVisible=!1,e.init(),Object(f.b)(t.data.desc)):Object(f.a)(t.data.desc),e.dialogLoading=!1}))}}))},handleShowTeacher:function(t){this.$refs.popverPartRef._handleOpen()},handleHideeacher:function(){this.$refs.popverPartRef&&this.$refs.popverPartRef._handleResetChange()},handleSelUser:function(data){this.form.dormitoryIdList=data},handleChange:function(data,t){1==t?this.form.switchContinue=data:2==t?this.form.earlyEnable=data:3==t&&(this.form.continueSection=data)},handleChangeTime:function(data,t){1==t?this.form.startTime=data:2==t&&(this.form.endTime=data)},changeRollCall:function(t){t.rollCall=!t.rollCall},handleWeek:function(data,t){this.tableDayInfo.map((function(e,n){e.days.map((function(e,n){e&&e.weekNo==t&&(e.rollCall=data)}))}))}}},R=(n(1741),n(10)),component=Object(R.a)(S,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"container"},[o("layout-tb",[o("template",{slot:"tag"},[t._v("例外设置")]),t._v(" "),o("div",{attrs:{slot:"tab"},slot:"tab"},[o("el-row",[o("el-col",{attrs:{span:18}},[o("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(e){return t.addInfo(e)}}},[t._v(t._s(t.$t("添加例外规则")))]),t._v(" "),o("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-s-help"},on:{click:function(e){return t.syncInfo(e)}}},[t._v(t._s(t.$t("同步生效")))])],1),t._v(" "),o("el-col",{staticClass:"text-right",attrs:{span:6}})],1)],1),t._v(" "),o("div",{attrs:{slot:"content"},slot:"content"},[o("el-table",{ref:"refTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"header-cell-class-name":"custom-table-cell-bg",size:"medium","row-key":"id","max-height":t.tableHeight.height}},[o("el-table-column",{attrs:{align:"center",label:t.$t("名称")},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},[t._v(t._s(e.row.name))]),t._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[0==e.row.rull_type?o("span",{staticClass:"color-muted"},[t._v(t._s(e.row.name))]):t._e(),t._v(" "),0!=e.row.rull_type?o("span",[t._v(t._s(e.row.name))]):t._e()])])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:t.$t("例外人员")},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-popover",{attrs:{trigger:"hover",width:"400",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},t._l(e.row.real_name_list.split(","),(function(e,n){return o("el-tag",{key:n,staticClass:"margin-right-5 margin-bottom-5",attrs:{size:"mini",type:"success"}},[t._v(t._s(e))])})),1),t._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},t._l(e.row.real_name_list.split(","),(function(e,n){return o("el-tag",{key:n,staticClass:"margin-right-5",attrs:{size:"mini",type:"success"}},[t._v(t._s(e))])})),1)])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:t.$t("考勤时间")},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",[t._v(t._s(e.row.start_time)+"-"+t._s(e.row.end_time))])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("i",{staticClass:"fa fa-edit color-grand margin-right-5",on:{click:function(n){return t.editInfo(e.row)}}}),t._v(" "),0!=e.row.rull_type?o("i",{staticClass:"fa fa-trash color-danger",on:{click:function(n){return t.deleteInfo(e.row)}}}):t._e()]}}])})],1),t._v(" "),o("div",{staticClass:"layout-right-footer text-right"},[o("my-pagination",{staticClass:"layout-pagination",attrs:{total:t.total,"current-page":t.page,"page-size":t.num},on:{currentPage:t.currentPage,sizeChange:t.sizeChange,jumpChange:t.jumpPage}})],1)],1)],2),t._v(" "),o("dialog-normal",{attrs:{"width-style":"750px",visible:t.modalVisible,title:t.$t("设置分组")},on:{close:t.closeDialog,"right-close":t.cancelDialog}},[o("div",{staticClass:"margin-top-10"},[o("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"140px"}},[o("el-form-item",{attrs:{label:t.$t("组名"),prop:"name"}},[o("el-input",{staticClass:"width-260",model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:t.$t("时间设置")}},[o("el-time-picker",{staticClass:"layout-item",staticStyle:{width:"128px"},attrs:{clearable:!1,"value-format":"HH:mm",format:"HH:mm",placeholder:t.$t("选择时间")},on:{change:function(e){return t.handleChangeTime(e,1)}},model:{value:t.form.startTime,callback:function(e){t.$set(t.form,"startTime",e)},expression:"form.startTime"}}),t._v("\n          -\n          "),o("el-time-picker",{staticClass:"layout-item",staticStyle:{width:"128px"},attrs:{clearable:!1,"value-format":"HH:mm",format:"HH:mm",placeholder:t.$t("选择时间")},on:{change:function(e){return t.handleChangeTime(e,2)}},model:{value:t.form.endTime,callback:function(e){t.$set(t.form,"endTime",e)},expression:"form.endTime"}})],1),t._v(" "),o("el-form-item",{attrs:{label:t.$t("状态设置"),prop:"name"}},[o("table",{staticClass:"custom-table"},[o("tr",[o("th"),t._v(" "),o("th",[t._v(t._s(t.$t("周一"))),o("my-check",{on:{change:function(e){return t.handleWeek(e,1)}}})],1),t._v(" "),o("th",[t._v(t._s(t.$t("周二"))),o("my-check",{on:{change:function(e){return t.handleWeek(e,2)}}})],1),t._v(" "),o("th",[t._v(t._s(t.$t("周三"))),o("my-check",{on:{change:function(e){return t.handleWeek(e,3)}}})],1),t._v(" "),o("th",[t._v(t._s(t.$t("周四"))),o("my-check",{on:{change:function(e){return t.handleWeek(e,4)}}})],1),t._v(" "),o("th",[t._v(t._s(t.$t("周五"))),o("my-check",{on:{change:function(e){return t.handleWeek(e,5)}}})],1),t._v(" "),o("th",[t._v(t._s(t.$t("周六"))),o("my-check",{on:{change:function(e){return t.handleWeek(e,6)}}})],1),t._v(" "),o("th",[t._v(t._s(t.$t("周日"))),o("my-check",{on:{change:function(e){return t.handleWeek(e,7)}}})],1)]),t._v(" "),o("tbody",t._l(t.tableDayInfo,(function(e,l){return o("tr",{key:l},[o("td",[o("div",{staticClass:"setting-td color-muted"},[t._v("\n                    "+t._s(t.$t("第"))+t._s(e.weekNum)+t._s(t.$t("周"))+"\n                  ")])]),t._v(" "),t._l(e.days,(function(e,l){return o("td",{key:l},[o("div",{staticClass:"setting-td color-muted",on:{click:function(n){return t.changeRollCall(e)}}},[null!=e&&1==e.rollCall?o("img",{staticClass:"setting-icon",attrs:{src:n(1535)}}):t._e(),t._v(" "),o("label",{staticStyle:{"font-weight":"normal"}},[t._v(t._s(null!=e?e.busiTime:""))])])])}))],2)})),0)])]),t._v(" "),o("el-form-item",{attrs:{label:t.$t("晚归设置"),prop:"delay"}},[o("span",[t._v(t._s(t.$t("超过考勤时间")))]),o("el-input",{staticStyle:{width:"80px"},model:{value:t.form.delay,callback:function(e){t.$set(t.form,"delay",e)},expression:"form.delay"}}),o("span",[t._v(t._s(t.$t("分钟标记为晚归")))])],1),t._v(" "),o("el-form-item",{attrs:{label:t.$t("例外学生"),prop:"dormitoryIdList"}},[o("el-popover",{attrs:{"popper-class":"custom-popper-class-form",placement:"top",width:"700",trigger:"click"},on:{show:function(e){return t.handleShowTeacher(3)},hide:t.handleHideeacher}},[o("div",[o("student-tree-and-list",{ref:"popverPartRef",attrs:{"sel-arr":t.form.dormitoryIdList,"set-type":"check"},on:{select:t.handleSelUser}})],1),t._v(" "),o("el-button",{attrs:{slot:"reference",type:"success",plain:"",size:"small"},slot:"reference"},[t._v(t._s(t.$t("添加")))])],1),t._v(" "),o("span",{staticClass:"color-warning margin-left-10"},[o("i",{staticClass:"fa fa-user"}),t._v("\n            "+t._s(t.$t("已选择"))+t._s(t.form.dormitoryIdList.length)+t._s(t.$t("个学生"))+"\n          ")])],1)],1)],1),t._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small"},on:{click:t.cancelDialog}},[t._v(t._s(t.$t("取消")))]),t._v(" "),o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){0==t.dialogLoading&&t.okDialog()}}},[t.dialogLoading?o("i",{staticClass:"el-icon-loading"}):t._e(),t._v("\n        "+t._s(t.$t("确定"))+"\n      ")])],1)]),t._v(" "),o("my-normal-dialog",{attrs:{visible:t.visibleConfim,loading:t.dialogLoading,title:"提示",detail:t.subTitle,content:t.tips},on:{"update:visible":function(e){t.visibleConfim=e},"ok-click":t.handleOkChange,"cancel-click":t.handleCancelChange,close:t.closeDialog}})],1)}),[],!1,null,"ad0696d4",null);e.default=component.exports;installComponents(component,{MyPagination:n(234).default,LayoutTb:n(1261).default,MyCheck:n(1276).default,StudentTreeAndList:n(1314).default,DialogNormal:n(235).default,MyNormalDialog:n(1260).default})}}]);