(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{1345:function(t,e,o){var content=o(1599);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(31).default)("335d1af6",content,!0,{sourceMap:!1})},1598:function(t,e,o){"use strict";var l=o(1345);o.n(l).a},1599:function(t,e,o){(e=o(30)(!1)).push([t.i,"",""]),t.exports=e},2003:function(t,e,o){"use strict";o.r(e);o(360),o(106),o(710),o(107);var l=o(7),r=o(235),n=o(1260),d=o(1268),c=o(1265),m=o(1256),f=o(6),h=o(76),v=o(1344),_=o(1262),y={mixins:[h.a,v.a],components:{MyElTree:_.default,DialogNormal:r.default,MyNormalDialog:n.default,DrawerRight:d.default,MyCascader:c.default,MySelect:m.default},data:function(){return{tableData:[],searchBuildId:"",searchFloorNum:"",modalVisible:!1,dialogLoading:!1,visibleConfim:!1,drawerVisible:!1,drawerLoading:!1,subTitle:"",subDetail:"",uploadFile:l.a.doomroom_import_file+"?fileName="+encodeURIComponent(this.$t("宿舍分配模板.xlsx")),uploadAction:l.a.doomroom_import,uploadResult:{},uploadProcess:"",form:{id:"",buildName:"",buildData:[],floor:"",roomNo:"",areaTotal:"0",personTotal:"",type:"",video:!1,buildId:"",buildingName:"",floorNum:"",arrow:"",price:"",reamrks:"",goodsNum:"",teacherId:[],choseLimit:!1,imgList:[],roomPhotos:""}}},created:function(){this.init()},methods:{init:function(){var t=this,e={page:this.page,num:this.num,buildId:this.searchBuildId,floorNum:this.searchFloorNum};this.$axios.get(l.a.dormroom_page,{params:e}).then((function(e){e.data.data&&(t.tableData=e.data.data.list,t.total=e.data.data.totalCount,t.num=e.data.data.num,t.page=e.data.data.currentPage)}))},addInfo:function(){this.modalVisible=!0},editInfo:function(t){var e=t.teacher_id?t.teacher_id.split(","):[],o=t.room_photos?t.room_photos.split("|"):[];this.form={id:t.id,buildName:t.build_name,buildData:[t.build_id,t.floor_num],floor:"",roomNo:t.dormitory_no,areaTotal:"0",personTotal:t.people_num,type:""+t.type,video:!1,buildId:t.build_id,buildingName:t.build_name,floorNum:t.floor_num,arrow:t.room_orient,price:t.room_price,remarks:t.room_des,goodsNum:t.people_num,teacherId:e,choseLimit:0==t.chose_limit,imgList:o,roomPhotos:""},this.modalVisible=!0},deleteInfo:function(t){this.form.id=t.id,this.subDetail=t.dormitory_no,this.visibleConfim=!0},nodeClick:function(data){this.searchBuildId="",this.searchFloorNum="",6==data.unit?(this.searchBuildId=data.id,this.searchFloorNum=data.floorNum):7==data.unit&&(this.searchBuildId=data.buildId,this.searchFloorNum=data.floorNum),this.page=1,this.init()},search:function(){},dormTypeInfo:function(t){return Object(f.n)(t)},sizeChange:function(t){this.page=1,this.num=t,this.init()},currentPage:function(t){this.page=t,this.init()},jumpPage:function(data){this.page=data,this.init()},okDialog:function(t){var e=this,o="";this.$refs.form.validate((function(t){if(t){for(var r="",i=0;i<e.form.imgList.length;i++)i!=e.form.imgList.length-1?r+=e.form.imgList[i]+"|":r+=e.form.imgList[i];e.dialogLoading=!0;var n={dormitoryNo:e.form.roomNo,area:e.form.areaTotal,type:e.form.type,peopleNum:e.form.personTotal,goodsNum:e.form.personTotal,status:1,roomPrice:e.form.price,roomOrient:e.form.arrow,roomDes:e.form.remarks,floorNum:e.form.buildData[1],buildId:e.form.buildData[0],choseLimit:1==e.form.choseLimit?0:1,teacherId:e.form.teacherId.join(),roomPhotos:r};""!=e.form.id?(o=l.a.dormroom_update,n.dormitoryId=e.form.id):o=l.a.dormroom_add,n=e.$qs.stringify(n),e.$axios.post(o,n,{loading:!1}).then((function(t){200==t.data.code?(e.modalVisible=!1,e.init(),Object(f.b)(t.data.desc)):Object(f.a)(t.data.desc),e.dialogLoading=!1}))}}))},closeDialog:function(t){this.form={id:"",buildName:"",buildData:[],floor:"",roomNo:"",areaTotal:"0",personTotal:"",type:"",video:!1,buildId:"",buildingName:"",floorNum:"",arrow:"",price:"",reamrks:"",goodsNum:"",teacherId:[],choseLimit:!1,imgList:[],roomPhotos:""},this.subTitle="",this.$set(this.form,"buildData",[]),this.resetCasadeSelector("SelectorBuild"),this.$refs.form&&this.$refs.form.resetFields()},cancelDialog:function(){this.modalVisible=!1},cancelDrawDialog:function(){this.drawerVisible=!1},closeDrawerDialog:function(t){this.drawerVisible=t},handleChangeSelect:function(data){this.form.type=data},closeDrawDialog:function(t){this.drawerVisible=!1},okDrawDialog:function(t){var e=this;this.drawerLoading=!0,setTimeout((function(){e.$message({message:"恭喜你，这是一条成功消息",type:"success"}),e.drawerLoading=!1,e.drawerVisible=!1}),2e3)},handleOkChange:function(data){var t=this;this.dialogLoading=!0;var e,o={dormitoryId:this.form.id};e=l.a.dormroom_delete,o=this.$qs.stringify(o),this.$axios.post(e,o).then((function(e){200==e.data.code?(t.init(),Object(f.b)(e.data.desc)):Object(f.a)(e.data.desc),t.visibleConfim=!1,t.dialogLoading=!1}))},handleCancelChange:function(data){this.visibleConfim=!1},handleCascaderChange:function(data){this.form.buildName=this.$refs.SelectorBuild.$refs.cascaderSelector.getCheckedNodes()[0].pathLabels[0],this.form.buildData=data},uploadClassRoom:function(t){this.drawerVisible=!0},uploadSuccess:function(t,e){if(200==t.code)this.uploadProcess=t.desc,this.loopUploadResult(t.data);else if(this.uploadProcess=this.$t("文件上传成功,正在导入文件..."),this.resultList=[],t.data)for(var i in t.data)this.uploadResult.push(t.data[i]);else this.uploadResult=[t.desc]},uploadError:function(t,e){this.uploadProcess=t.data.data},loopUploadResult:function(t){this.getUploadResult(t)},getUploadResult:function(t){var e=this,o=this,r=0;clearTimeout(this.loopTimer);var n={uuid:t,action:3};this.$axios.get(l.a.upload_loop_result,{params:n}).then((function(l){if(200==l.data.code){var n=[];if(l.data.data)for(var i=0;i<l.data.data.length;i++)l.data.data[i].line?n.push(e.$t("第")+l.data.data[i].line+e.$t("行")+JSON.parse(l.data.data[i].mess).join()):n.push(JSON.parse(l.data.data[i].mess).join()),1==l.data.data[i].status&&r++,r>0?(e.uploadResult=n,clearTimeout(e.loopTimer),e.loopTimer=null,e.uploadProcess=e.$t("导入操作已完成，请查看上传结果！")):e.loopTimer=setTimeout((function(){o.getUploadResult(t)}),1e4);else e.uploadResult=[e.$t("上传停止！")],clearTimeout(e.loopTimer)}}))}}},w=(o(1598),o(10)),component=Object(w.a)(y,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"container"},[o("layout-lr",[o("div",{attrs:{slot:"left"},slot:"left"},[o("div",{staticClass:"color-muted font-size-12 padding-tb-5 margin-top-10"},[o("span",{staticClass:"layout-left-menu-title"},[t._v("宿舍信息")])]),t._v(" "),o("my-el-tree",{attrs:{type:"2","sub-type":"2"},on:{"node-click":t.nodeClick,"all-click":t.nodeClick}})],1),t._v(" "),o("div",{attrs:{slot:"right"},slot:"right"},[o("div",{staticClass:"layout-top-tab margin-top-5"},[o("el-row",[o("el-col",{attrs:{span:12}},[o("el-col",{attrs:{span:12}},[o("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(e){return t.addInfo(e)}}},[t._v(t._s(t.$t("添加宿舍")))]),t._v(" "),o("el-button",{attrs:{size:"small",type:"warning",plain:"",icon:"el-icon-notebook-2"},on:{click:function(e){return t.uploadClassRoom(e)}}},[t._v(t._s(t.$t("导入宿舍")))])],1)],1)],1)],1),t._v(" "),o("div",{staticClass:"margin-top-10"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,"header-cell-class-name":"custom-table-cell-bg",size:"medium","max-height":t.tableHeight2.height}},[o("el-table-column",{attrs:{prop:"dormitory_no",label:t.$t("编号"),align:"center"}}),t._v(" "),o("el-table-column",{attrs:{prop:"floor_num",label:t.$t("楼层"),align:"center"}}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("类型"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",[t._v(t._s(t.dormTypeInfo(e.row.type)))])]}}])}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("管理员"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},[o("label",[t._v(t._s(e.row.teacher_name?e.row.teacher_name:"--"))])]),t._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[o("label",[t._v(t._s(e.row.teacher_name?e.row.teacher_name:"--"))])])])]}}])}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("人数"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",[t._v(t._s(e.row.has_people_num))]),t._v("\n              /\n              "),o("span",[t._v(t._s(e.row.people_num))])]}}])}),t._v(" "),o("el-table-column",{attrs:{fixed:"right",label:t.$t("操作"),align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("i",{staticClass:"fa fa-edit margin-right-5 color-grand",on:{click:function(o){return t.editInfo(e.row)}}}),t._v(" "),o("i",{staticClass:"fa fa-trash color-danger",on:{click:function(o){return t.deleteInfo(e.row)}}})]}}])})],1)],1),t._v(" "),o("div",{staticClass:"layout-right-footer text-right"},[o("my-pagination",{staticClass:"layout-pagination",attrs:{total:t.total,"current-page":t.page,"page-size":t.num},on:{currentPage:t.currentPage,sizeChange:t.sizeChange,jumpChange:t.jumpPage}})],1)])]),t._v(" "),o("dialog-normal",{attrs:{top:"10vh",visible:t.modalVisible,title:t.$t("宿舍设置")},on:{close:t.closeDialog,"right-close":t.cancelDialog}},[o("div",{staticClass:"margin-top-10"},[o("el-form",{ref:"form",attrs:{rules:t.rules,model:t.form,"label-width":"140px"}},[o("el-form-item",{attrs:{label:"宿舍楼/楼层",prop:"buildData"}},[o("my-cascader",{ref:"SelectorBuild",attrs:{disabled:""!=t.form.id,"width-style":"260","sel-value":t.form.buildData,type:"2","sub-type":"2"},on:{change:function(e){return t.handleCascaderChange(e)}}})],1),t._v(" "),o("el-form-item",{attrs:{label:"房间编号",prop:"roomNo"}},[o("el-input",{staticClass:"width-260",model:{value:t.form.roomNo,callback:function(e){t.$set(t.form,"roomNo",e)},expression:"form.roomNo"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"宿舍类型",prop:"type"}},[o("my-select",{attrs:{"width-style":"260","sel-value":t.form.type,options:t.dormroomType},on:{change:function(e){return t.handleChangeSelect(e)}}})],1),t._v(" "),o("el-form-item",{attrs:{label:"宿舍人数",prop:"personTotal"}},[o("el-input",{staticClass:"width-260",model:{value:t.form.personTotal,callback:function(e){t.$set(t.form,"personTotal",e)},expression:"form.personTotal"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"宿舍朝向"}},[o("el-input",{staticClass:"width-260",model:{value:t.form.arrow,callback:function(e){t.$set(t.form,"arrow",e)},expression:"form.arrow"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"宿舍单价",prop:"price"}},[o("el-input",{staticClass:"width-260",model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"备注"}},[o("el-input",{staticClass:"width-260",model:{value:t.form.remarks,callback:function(e){t.$set(t.form,"remarks",e)},expression:"form.remarks"}})],1)],1)],1),t._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small"},on:{click:t.cancelDialog}},[t._v(t._s(t.$t("取消")))]),t._v(" "),o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){0==t.dialogLoading&&t.okDialog()}}},[t.dialogLoading?o("i",{staticClass:"el-icon-loading"}):t._e(),t._v("\n        "+t._s(t.$t("确定"))+"\n      ")])],1)]),t._v(" "),o("drawer-right",{attrs:{visible:t.drawerVisible,accept:".xls,.xlsx",data:{all:!0},loading:t.drawerLoading,"hide-footer":!0,size:"400px",title:t.$t("导入宿舍"),action:t.uploadAction,"download-file":t.uploadFile,result:t.uploadResult,process:t.uploadProcess},on:{changeDrawer:t.closeDrawerDialog,"right-close":t.cancelDrawDialog,success:t.uploadSuccess,error:t.uploadError}}),t._v(" "),o("my-normal-dialog",{attrs:{visible:t.visibleConfim,loading:t.dialogLoading,title:"提示",content:"确认需要删除该信息？",detail:t.subDetail},on:{"update:visible":function(e){t.visibleConfim=e},"ok-click":t.handleOkChange,"cancel-click":t.handleCancelChange,close:t.closeDialog}})],1)}),[],!1,null,"e3097f7c",null);e.default=component.exports;installComponents(component,{MyElTree:o(1262).default,MyPagination:o(234).default,LayoutLr:o(1264).default,MyCascader:o(1265).default,MySelect:o(1256).default,DialogNormal:o(235).default,DrawerRight:o(1268).default,MyNormalDialog:o(1260).default})}}]);