(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{1261:function(e,t,o){"use strict";o.r(t);var r={name:"LayoutTb",data:function(){return{showTab:!0,showTag:!1}},mounted:function(){this.showTab=void 0!==this.$slots.tab},created:function(){},methods:{}},n=o(10),component=Object(n.a)(r,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"color-muted font-size-12 padding-top-5 animated fadeInUp"},[e.showTag?o("span",{staticClass:"layout-menu-title"},[e._t("tag")],2):e._e()]),e._v(" "),e.showTab?o("div",{staticClass:"layout-top-tab margin-top-5"},[e._t("tab")],2):e._e(),e._v(" "),o("div",{staticClass:"layout-bottom-tab margin-top-10"},[e._t("content")],2)])}),[],!1,null,null,null);t.default=component.exports},1318:function(e,t,o){"use strict";var r=o(86),n=o.n(r);t.a={data:function(){return{rules:{no:[{required:!0,message:this.$t("请输入建筑楼编号"),trigger:"blur"},{validator:n.a.FormValidate.Form().validatesn1_10Reg,trigger:"blur"}],name:[{required:!0,message:this.$t("请输入建筑楼名称"),trigger:"blur"},{validator:n.a.FormValidate.Form().validatenall1_20Reg,trigger:"blur"}],floorTotal:[{required:!0,message:this.$t("请输入总楼层"),trigger:"blur"},{validator:n.a.FormValidate.Form().validateNumber,trigger:"blur"}],startFloor:[{required:!0,message:this.$t("请输入起始楼层"),trigger:"blur"},{validator:n.a.FormValidate.Form().validateNumber,trigger:"blur"}],phone:[{required:!1,validator:n.a.FormValidate.Form().validatePhone,trigger:"blur"}]}}}}},1372:function(e,t,o){var content=o(1651);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,o(31).default)("98313b8a",content,!0,{sourceMap:!1})},1650:function(e,t,o){"use strict";var r=o(1372);o.n(r).a},1651:function(e,t,o){(t=o(30)(!1)).push([e.i,".container[data-v-1a6af197]{padding:10px 15px}.web-auth-tree-border[data-v-1a6af197]{border-radius:5px;border:1px solid #dcdfe6;padding:10px 0}",""]),e.exports=t},1971:function(e,t,o){"use strict";o.r(t);o(360),o(65),o(107),o(53);var r=o(9),n=o(7),l=o(76),d=o(1260),c=o(235),h=o(6),m=(o(1318),o(86)),f=o.n(m),v={data:function(){return{rules:{roleNo:[{required:!0,message:this.$t("请输入编号"),trigger:"blur"},{validator:f.a.FormValidate.Form().validatesn1_10Reg,trigger:"blur"}],roleName:[{required:!0,message:this.$t("请输入名称"),trigger:"blur"},{validator:f.a.FormValidate.Form().validateS1_20Reg,trigger:"blur"}]}}}},_={mixins:[l.a,v],components:{MyNormalDialog:d.default,DialogNormal:c.default},data:function(){return{pageStudent:1,numStudent:20,totalStudent:0,tableData:[],tableTeacherData:[],modalVisible:!1,dialogLoading:!1,visibleConfim:!1,drawerVisible:!1,drawerLoading:!1,visibleEmployeeConfim:!1,subTitle:"",roleList:[],roleGourpMenuList:[],roleSetRoleList:[],oprType:"",form:{id:"",roleId:"",enable:!0,roleNo:"",roleName:"",partUserIds:[]},employeeId:""}},created:function(){this.initInfo()},methods:{initInfo:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getSessionInfo();case 2:e.init();case 3:case"end":return t.stop()}}),t)})))()},init:function(){var e=this,t={page:this.page,num:this.num};this.$axios.get(n.a.web_auth_group_page,{params:t}).then((function(t){t.data.data&&(e.tableData=t.data.data.list,e.total=t.data.data.totalCount,e.num=t.data.data.num,e.page=t.data.data.currentPage)}))},initTeacher:function(e){var t=this,o={page:this.pageStudent,num:this.numStudent,roleId:e};this.$axios(n.a.web_auth_group_role_user_list,{params:o}).then((function(e){e.data.data&&(t.tableTeacherData=e.data.data.list,t.totalStudent=e.data.data.totalCount,t.numStudent=e.data.data.num,t.pageStudent=e.data.data.currentPage),t.drawerLoading=!1}))},initRoleMenu:function(){var e=this,t={campusName:this.campusName};this.roleGourpMenuList=[];var o=[];this.$axios.get("https://campus.9451.com/campusmanage/appapi/system-menu",{params:t}).then((function(t){var r=[];if(t.data.data){for(var i=0;i<t.data.data.length;i++)r.push(t.data.data[i].key);var l={menuNo:r.join()};e.$axios.get(n.a.menuno_role_list3,{params:l}).then((function(r){if(r.data.data){for(var n=0;n<t.data.data.length;n++){o.push({key:t.data.data[n].key,name:t.data.data[n].name,label:t.data.data[n].name,children:[]});for(var l=0;l<r.data.data.length;l++)r.data.data[l].menu_no==t.data.data[n].key&&1==r.data.data[l].level&&o[n].children.push({key:r.data.data[l].menu_no,name:r.data.data[l].title,label:r.data.data[l].title,id:r.data.data[l].id,children:[]})}for(var d=0;d<o.length;d++)for(var c=0;c<o[d].children.length;c++)for(var h=0;h<r.data.data.length;h++)r.data.data[h].pId==o[d].children[c].id&&2==r.data.data[h].level&&o[d].children[c].children.push({key:r.data.data[h].menu_no,name:r.data.data[h].title,label:r.data.data[h].title,id:r.data.data[h].id,pId:r.data.data[h].pId});e.roleGourpMenuList=o,"set"==e.oprType&&e.initRoleSetMenu()}}))}}))},initRoleSetMenu:function(){var e=this,t=[],o={id:this.form.id};this.$axios.get(n.a.web_auth_group_role_menu_list,{params:o}).then((function(o){if(o.data.data)for(var i=0;i<o.data.data.length;i++)t.push(o.data.data[i].menu_id),e.$refs.customRoleMenuRef&&e.$refs.customRoleMenuRef.setChecked(o.data.data[i].menu_id,!0,!1)}))},userInfo:function(e){var t=this;this.drawerLoading=!0,this.form.id=e.id,this.pageStudent=1,this.totalStudent=20,setTimeout((function(){t.initTeacher(e.id)}),800),this.drawerVisible=!0},addInfo:function(){var e=this;this.oprType="add",setTimeout((function(){e.initRoleMenu()}),800),this.modalVisible=!0},setInfo:function(e){var t=this;this.oprType="set",this.form.id=e.id,setTimeout((function(){t.initRoleMenu()}),800),this.modalVisible=!0},editInfo:function(e){this.oprType="edit",this.form={id:e.id,roleNo:e.role_no,roleName:e.role_name,enable:e.enabled,partUserIds:[]},this.modalVisible=!0},deleteInfo:function(e){this.form.id=e.id,this.visibleConfim=!0},deleteEmployee:function(e){this.employeeId=e.user_id,this.form.roleId=e.user_role_id,this.visibleEmployeeConfim=!0},insterestInfo:function(e){return Object(h.v)(e)},okDialog:function(e){var t=this,o="",r=[];this.$refs.form.validate((function(e){if(e){var l={roleNo:t.form.roleNo,roleName:t.form.roleName};if("edit"==t.oprType&&""!=t.form.id)o=n.a.web_auth_group_edit,l.id=t.form.id,l.enabled=t.form.enable;else{"add"==t.oprType?o=n.a.web_auth_group_add:"set"==t.oprType&&(l.id=t.form.id,o=n.a.web_auth_group_edit_role);var d=t.$refs.customRoleMenuRef.getCheckedNodes(!1,!0);if(0==d.length)return void Object(h.c)(t.$t("请选择权限"));for(var i=0;i<d.length;i++)d[i].id&&r.push(d[i].id);l.menuIds=r.join()}l=t.$qs.stringify(l),t.dialogLoading=!0,t.$axios.post(o,l,{loading:!1}).then((function(e){200==e.data.code?(t.modalVisible=!1,t.init(),Object(h.b)(e.data.desc)):Object(h.a)(e.data.desc),t.dialogLoading=!1}))}}))},closeDialog:function(e){this.form={id:"",roleId:"",enable:!0,roleNo:"",roleName:"",partUserIds:[]},this.subTitle="",this.roleGourpMenuList=[],this.employeeId="",this.pageStudent=1,this.totalStudent=20,this.$refs.form&&this.$refs.form.resetFields()},closeVisibleDialog:function(e){this.subTitle="",this.employeeId=""},cancelDialog:function(){this.modalVisible=!1},handleOkChange:function(data){var e=this;this.dialogLoading=!0;var t,o={id:this.form.id};t=n.a.web_auth_group_del,o=this.$qs.stringify(o),this.$axios.post(t,o).then((function(t){200==t.data.code?(e.init(),Object(h.b)(t.data.desc)):Object(h.a)(t.data.desc),e.visibleConfim=!1,e.dialogLoading=!1}))},handleEmployeeOkChange:function(){var e,t=this,o={id:this.form.roleId,userId:this.employeeId};e=n.a.web_auth_group_role_user_del,this.dialogLoading=!0,this.$axios.get(e,{params:o}).then((function(e){200==e.data.code?(t.initTeacher(t.form.id),Object(h.b)(e.data.desc)):Object(h.a)(e.data.desc),t.visibleEmployeeConfim=!1,t.dialogLoading=!1}))},handleCancelChange:function(data){this.visibleConfim=!1,this.visibleEmployeeConfim=!1},handleChangeEnable:function(data){this.form.enable=data},cancelDrawDialog:function(){this.form={id:"",enable:!0,roleNo:"",roleName:"",partUserIds:[]},this.$refs.popverPartRef&&this.$refs.popverPartRef._handleResetChange(),this.drawerVisible=!1},closeDrawerDialog:function(e){this.form={id:"",enable:!0,roleNo:"",roleName:"",partUserIds:[]},this.$refs.popverPartRef&&this.$refs.popverPartRef._handleResetChange(),this.drawerVisible=e},handleShowTeacher:function(e){1==e&&this.$refs.popverPartRef._handleOpen()},handleHideeacher:function(){this.$refs.popverPartRef&&this.$refs.popverPartRef._handleResetChange()},handleSelUser:function(data,e){1==e&&(this.form.partUserIds=data)},saveRoleEmployee:function(){var e=this,t=[];if(0!=this.form.partUserIds.length){for(var i=0;i<this.form.partUserIds.length;i++)t.push(this.form.partUserIds[i].user_id);var o={roleId:this.form.id,userIds:t.join()},r=n.a.web_auth_group_role_user_add;o=this.$qs.stringify(o),this.$axios.post(r,o).then((function(t){200==t.data.code?(e.initTeacher(e.form.id),e.form.partUserIds=[],Object(h.b)(t.data.desc)):Object(h.a)(t.data.desc),e.visibleConfim=!1,e.dialogLoading=!1}))}},sizeStudentChange:function(e){this.pageStudent=1,this.numStudent=e,this.initTeacher(this.form.id)},currentStudentPage:function(e){this.pageStudent=e,this.initTeacher(this.form.id)},sizeChange:function(e){this.page=1,this.num=e,this.init()},currentPage:function(e){this.page=e,this.init()},jumpPage:function(data){this.page=data,this.init()}}},w=(o(1650),o(10)),component=Object(w.a)(_,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"container"},[o("layout-tb",[o("template",{slot:"tag"},[e._v("WEB权限")]),e._v(" "),o("div",{attrs:{slot:"tab"},slot:"tab"},[o("el-row",[o("el-col",{attrs:{span:12}},[o("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.addInfo(t)}}},[e._v(e._s(e.$t("添加角色")))])],1)],1)],1),e._v(" "),o("div",{attrs:{slot:"content"},slot:"content"},[o("el-table",{ref:"refTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-class-name":"custom-table-cell-bg",size:"medium","max-height":e.tableHeight.height}},[o("el-table-column",{attrs:{align:"center",prop:"role_no",label:e.$t("编号")}}),e._v(" "),o("el-table-column",{attrs:{align:"center",prop:"role_name",label:e.$t("名称")}}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:e.$t("状态")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.enabled?o("span",{staticClass:"color-success"},[e._v(e._s(e.$t("启用")))]):e._e(),e._v(" "),t.row.enabled?e._e():o("span",{staticClass:"color-danger"},[e._v(e._s(e.$t("禁用")))])]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("i",{staticClass:"fa fa-cog margin-right-5 color-grand",on:{click:function(o){return e.setInfo(t.row)}}}),e._v(" "),o("i",{staticClass:"fa fa-users margin-right-5 color-warning",on:{click:function(o){return e.userInfo(t.row)}}}),e._v(" "),o("i",{staticClass:"fa fa-edit margin-right-5 color-grand",on:{click:function(o){return e.editInfo(t.row)}}}),e._v(" "),o("i",{staticClass:"fa fa-trash color-danger",on:{click:function(o){return e.deleteInfo(t.row)}}})]}}])})],1),e._v(" "),o("div",{staticClass:"layout-right-footer text-right"},[o("my-pagination",{staticClass:"layout-pagination",attrs:{total:e.total,"page-size":e.num},on:{currentPage:e.currentPage,sizeChange:e.sizeChange}})],1)],1)],2),e._v(" "),o("dialog-normal",{attrs:{visible:e.modalVisible,title:e.$t("权限设置")},on:{close:e.closeDialog,"right-close":e.cancelDialog}},[o("div",{staticClass:"margin-top-10"},[o("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"140px"}},["set"!=e.oprType?o("div",[o("el-form-item",{attrs:{label:e.$t("角色编号"),prop:"roleNo"}},[o("el-input",{staticClass:"width-260",model:{value:e.form.roleNo,callback:function(t){e.$set(e.form,"roleNo",t)},expression:"form.roleNo"}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.$t("角色名称"),prop:"roleName"}},[o("el-input",{staticClass:"width-260",model:{value:e.form.roleName,callback:function(t){e.$set(e.form,"roleName",t)},expression:"form.roleName"}})],1)],1):e._e(),e._v(" "),"add"==e.oprType||"set"==e.oprType?o("el-form-item",{attrs:{label:e.$t("权限")}},[o("div",{staticClass:"web-auth-tree-border"},[o("el-tree",{ref:"customRoleMenuRef",staticClass:"margin-left-20",attrs:{data:e.roleGourpMenuList,"show-checkbox":"","node-key":"id"}})],1)]):e._e(),e._v(" "),"edit"==e.oprType?o("el-form-item",{attrs:{label:e.$t("状态")}},[o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(t){return e.handleChangeEnable(t)}},model:{value:e.form.enable,callback:function(t){e.$set(e.form,"enable",t)},expression:"form.enable"}})],1):e._e()],1)],1),e._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small"},on:{click:e.cancelDialog}},[e._v(e._s(e.$t("取消")))]),e._v(" "),o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){0==e.dialogLoading&&e.okDialog()}}},[e.dialogLoading?o("i",{staticClass:"el-icon-loading"}):e._e(),e._v("\n          "+e._s(e.$t("确定"))+"\n        ")])],1)]),e._v(" "),o("drawer-layout-right",{attrs:{tabindex:"0",visible:e.drawerVisible,loading:e.drawerLoading,size:"550px",title:e.$t("成员设置")},on:{changeDrawer:e.closeDrawerDialog,"right-close":e.cancelDrawDialog}},[o("div",{attrs:{slot:"content"},slot:"content"},[o("div",[o("el-popover",{attrs:{"popper-class":"custom-popper-class-form",placement:"top",width:"700",trigger:"click"},on:{show:function(t){return e.handleShowTeacher(1)},hide:e.handleHideeacher}},[o("div",[o("teacher-tree-and-list",{ref:"popverPartRef",attrs:{"sel-arr":e.form.partUserIds,"set-type":"check"},on:{select:function(t){return e.handleSelUser(t,1)}}})],1),e._v(" "),o("el-button",{attrs:{slot:"reference",size:"small",type:"primary",icon:"el-icon-user"},slot:"reference"},[e._v(e._s(e.$t("添加成员")))])],1),e._v(" "),o("span",[o("el-button",{attrs:{size:"small",type:"warning",disabled:0==e.form.partUserIds.length},on:{click:e.saveRoleEmployee}},[o("span",{staticClass:"color-white"},[e._v(e._s(e.$t("保存成员设置")))])])],1)],1),e._v(" "),o("table",{staticClass:"custom-table margin-top-10"},[o("tr",[o("th",{attrs:{width:"30%"}},[e._v(e._s(e.$t("姓名")))]),e._v(" "),o("th",{attrs:{width:"20%"}},[e._v(e._s(e.$t("工号")))]),e._v(" "),o("th",{attrs:{width:"20%"}},[e._v(e._s(e.$t("手机")))]),e._v(" "),o("th",{attrs:{width:"20%"}},[e._v(e._s(e.$t("部门 ")))]),e._v(" "),o("th",{attrs:{width:"10%"}},[e._v(e._s(e.$t("操作 ")))])]),e._v(" "),o("tbody",{directives:[{name:"loading",rawName:"v-loading",value:e.drawerLoading,expression:"drawerLoading"}],attrs:{"element-loading-text":e.$t("加载中..."),"element-loading-spinner":"el-icon-loading"}},e._l(e.tableTeacherData,(function(t,r){return o("tr",{key:t.id},[o("td",[o("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},[e._v(e._s(t.real_name))]),e._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[e._v("\n                    "+e._s(t.real_name)+"\n                  ")])])],1),e._v(" "),o("td",[o("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},[e._v(e._s(t.job_num))]),e._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[e._v("\n                    "+e._s(t.job_num)+"\n                  ")])])],1),e._v(" "),o("td",[o("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},[e._v(e._s(t.phone))]),e._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[e._v("\n                    "+e._s(t.phone)+"\n                  ")])])],1),e._v(" "),o("td",[o("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},[e._v(e._s(t.depart_name))]),e._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[e._v("\n                    "+e._s(t.depart_name)+"\n                  ")])])],1),e._v(" "),o("td",[o("i",{staticClass:"fa fa-trash color-danger",on:{click:function(o){return e.deleteEmployee(t)}}})])])})),0)])]),e._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("el-pagination",{attrs:{background:"","page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",total:e.totalStudent,"current-page":e.pageStudent,"page-size":e.numStudent},on:{"size-change":e.sizeStudentChange,"current-change":e.currentStudentPage}})],1)]),e._v(" "),o("my-normal-dialog",{attrs:{visible:e.visibleConfim,loading:e.dialogLoading,title:"提示",content:"删除操作将会自动解除拥有该角色的用户的操作权限。是否继续删除？"},on:{"update:visible":function(t){e.visibleConfim=t},"ok-click":e.handleOkChange,"cancel-click":e.handleCancelChange,close:e.closeDialog}}),e._v(" "),o("my-normal-dialog",{attrs:{visible:e.visibleEmployeeConfim,loading:e.dialogLoading,title:"提示",content:"移除后用户将无法继续操作该角色权限的菜单。是否继续移除？"},on:{"update:visible":function(t){e.visibleEmployeeConfim=t},"ok-click":e.handleEmployeeOkChange,"cancel-click":e.handleCancelChange,close:e.closeVisibleDialog}})],1)}),[],!1,null,"1a6af197",null);t.default=component.exports;installComponents(component,{MyPagination:o(234).default,LayoutTb:o(1261).default,DialogNormal:o(235).default,TeacherTreeAndList:o(1285).default,DrawerLayoutRight:o(236).default,MyNormalDialog:o(1260).default})}}]);