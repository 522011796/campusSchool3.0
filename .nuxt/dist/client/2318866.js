(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{1362:function(t,e,o){var content=o(1631);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(31).default)("5a95ebc8",content,!0,{sourceMap:!1})},1630:function(t,e,o){"use strict";var n=o(1362);o.n(n).a},1631:function(t,e,o){(e=o(30)(!1)).push([t.i,".container[data-v-4c7d86af]{padding:10px 15px}.news-img[data-v-4c7d86af]{height:50px;width:50px}",""]),t.exports=e},2015:function(t,e,o){"use strict";o.r(e);o(360),o(65),o(106),o(710),o(53);var n=o(9),r=o(76),l=o(1261),c=o(1257),d=o(234),f=o(235),m=o(1260),h=o(1268),v=o(236),y=o(7),_=o(6),w=o(1286),D=o(1287),C=o(1288),$=o(1269),x=o(1289),k=o(1306),T={mixins:[r.a,k.a],components:{MyRadio:$.default,LayoutTb:l.default,MyInputButton:c.default,MyPagination:d.default,DialogNormal:f.default,MyNormalDialog:m.default,DrawerRight:h.default,DrawerLayoutRight:v.default,MyFlowType:w.default,MyFlowCondition:D.default,MyFlowProcess:C.default,MyFlowProcessList:x.default},data:function(){return{modalVisible:!1,drawerVisible:!1,visibleConfim:!1,dialogLoading:!1,loading:!1,drawerLoading:!1,subTitle:"",uploadFile:y.a.upload_file,uploadResult:{},uploadProcess:"",g_superId:"",searchKey:"",tableData:[],errorTips:"",addStatus:"",form:{id:"",name:"",content:"",conditionType:"1",conditionDay1:"",conditionDay2:"",status:!0,handleProcess:[]}}},created:function(){this.initInfo()},methods:{initInfo:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getSessionInfo();case 2:t.init();case 3:case"end":return e.stop()}}),e)})))()},init:function(){var t=this,e={page:this.page,num:this.num,applyTypeCode:"LeaveApply",name:this.searchKey};this.$axios.get(y.a.flow_center_page,{params:e}).then((function(e){e.data.data&&(t.tableData=e.data.data.list,t.total=e.data.data.totalCount,t.num=e.data.data.num,t.page=e.data.data.currentPage)}))},addInfo:function(){"edit"==this.addStatus&&this.clearDrawerDialog(),this.drawerVisible=!0},editInfo:function(t){this.addStatus="edit",this.form={id:t.id,name:t.name,content:t.des,conditionType:"1",conditionDay1:"",conditionDay2:"",status:t.enable,handleProcess:[]};for(var e=t.handle_condition,i=0;i<e.length;i++)"leaveDay"!=e[i].type&&"DoorOpenApply"!=e[i].type||(0==e[i].value1&&0==e[i].value2?this.form.conditionType="1":(this.form.conditionType="2",this.form.conditionDay1=e[i].value1,this.form.conditionDay2=e[i].value2));for(var o=t.handle_process,n=0;n<o.length;n++){for(var r=o[n].hname?o[n].hname.split(","):[],l=o[n].nid?o[n].nid.split(","):[],c=[],d=0;d<r.length;d++)c.push({user_id:r[d].split("@*@")[0],real_name:r[d].split("@*@")[1]});this.form.handleProcess.push({type:o[n].htype,audit:c,auditName:r,share:l,notice:o[n].andor})}this.drawerVisible=!0},deleteInfo:function(t){this.form.id=t.id,this.subTitle=t.name,this.visibleConfim=!0},cancelDialog:function(){this.modalVisible=!1},cancelDrawDialog:function(){this.clearDrawerDialog(),this.drawerVisible=!1},closeDialog:function(t){},clearDrawerDialog:function(){this.form={id:"",name:"",content:"",conditionType:"1",conditionDay1:"",conditionDay2:"",status:!0,handleProcess:[]},this.$refs.form&&this.$refs.form.resetFields(),this.$refs.flowProcessRef&&this.$refs.flowProcessRef._handleResetChange(),this.errorTips="",this.addStatus=""},closeDrawerDialog:function(t){this.drawerVisible=t},handleCloseDrawer:function(){this.form={id:"",name:"",content:"",conditionType:"1",conditionDay1:"",conditionDay2:"",status:!0,handleProcess:[]},this.$refs.form&&this.$refs.form.resetFields(),this.$refs.flowProcessRef&&this.$refs.flowProcessRef._handleResetChange()},closeDrawDialog:function(t){this.drawerVisible=!1},okDrawDialog:function(t){var e=this,o="";this.errorTips="";var n=0;this.$refs.form.validate((function(t){if(t){if(2==e.form.conditionType&&(""==e.form.conditionDay1||""==e.form.conditionDay2))return void(e.errorTips="请输入信息");var r={applyTypeCode:"LeaveApply",des:e.form.content,enable:e.form.status,name:e.form.name};1==e.form.conditionType?r.handleConditions=[{type:"leaveDay",value1:0,value2:0}]:2==e.form.conditionType&&(r.handleConditions=[{type:"leaveDay",value1:e.form.conditionDay1,value2:e.form.conditionDay2}]);for(var l=e.$refs.flowProcessRef._getFlowProcessData(),c=[],i=0;i<l.length;i++){for(var d=[],f=[],m=[],h=0;h<l[i].audit.length;h++)d.push(l[i].audit[h].user_id);for(var v=0;v<l[i].auditName.length;v++)m.push(l[i].auditName[v]);for(var w=0;w<l[i].share.length;w++)f.push(l[i].share[w].user_id);c.push({horder:i,htype:l[i].type,hid:d.join(),hname:m.join(),nid:f.join(),andor:l[i].notice}),"AnyUser"==l[i].type&&0==d.length&&n++}if(n>0)return void Object(_.c)("请设置固定教师中的审批教师");r.handleProcess=c,""!=e.form.id&&(r.id=e.form.id),o=y.a.flow_center_update,e.drawerLoading=!0,e.$axios.post(o,r,{dataType:"stringfy"}).then((function(t){200==t.data.code?(e.drawerVisible=!1,e.init(),e.clearDrawerDialog(),Object(_.b)(t.data.desc)):Object(_.a)(t.data.desc),e.drawerLoading=!1}))}}))},handleOkChange:function(data){var t=this;this.dialogLoading=!0;var e={id:this.form.id};e=this.$qs.stringify(e),this.$axios.post(y.a.flow_center_del,e).then((function(e){200==e.data.code?(t.init(),t.form.id="",Object(_.b)(e.data.desc)):Object(_.a)(e.data.desc),t.visibleConfim=!1,t.dialogLoading=!1}))},handleCancelChange:function(data){this.visibleConfim=!1},search:function(t){this.page=1,this.searchKey=t.input,this.init()},sizeChange:function(t){this.page=1,this.num=t,this.init()},currentPage:function(t){this.page=t,this.init()},jumpPage:function(data){this.page=data,this.init()},handleChange:function(t){this.form.conditionType=t},changeStatus:function(t,data){this.form.status=data}}},P=(o(1630),o(10)),component=Object(P.a)(T,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"container"},[o("layout-tb",[o("template",{slot:"tag"},[t._v("学生请假申请")]),t._v(" "),o("div",{attrs:{slot:"tab"},slot:"tab"},[o("el-row",[o("el-col",{attrs:{span:12}},[o("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(e){return t.addInfo(e)}}},[t._v(t._s(t.$t("添加流程")))])],1),t._v(" "),o("el-col",{staticClass:"text-right",attrs:{span:12}},[o("my-input-button",{attrs:{size:"small",plain:"","width-class":"width: 150px",type:"success",clearable:!0,placeholder:t.$t("名称")},on:{click:t.search}})],1)],1)],1),t._v(" "),o("div",{attrs:{slot:"content"},slot:"content"},[o("el-table",{ref:"refTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"header-cell-class-name":"custom-table-cell-bg",size:"medium","max-height":t.tableHeight.height}},[o("el-table-column",{attrs:{align:"center",label:t.$t("日期")},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},[t._v(t._s(t.$moment(e.row.add_time).format("YYYY-MM-DD HH:mm")))]),t._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[t._v("\n                "+t._s(t.$moment(e.row.add_time).format("YYYY-MM-DD HH:mm"))+"\n              ")])])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",label:t.$t("流程名称")},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},[t._v(t._s(e.row.name?e.row.name:"--"))]),t._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[t._v("\n                "+t._s(e.row.name?e.row.name:"--")+"\n              ")])])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",prop:"department_no",label:t.$t("申请类型")},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},[o("my-flow-type",{attrs:{status:e.row.apply_type_code}})],1),t._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[o("my-flow-type",{attrs:{status:e.row.apply_type_code}})],1)])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",prop:"department_no",label:t.$t("条件")},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},[o("my-flow-condition",{attrs:{condition:e.row.handle_condition,"condition-type-code":e.row.apply_type_code}})],1),t._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[o("my-flow-condition",{attrs:{condition:e.row.handle_condition,"condition-type-code":e.row.apply_type_code}})],1)])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",prop:"department_no",label:t.$t("流程"),width:"200"},scopedSlots:t._u([{key:"default",fn:function(t){return[o("my-flow-process",{attrs:{process:t.row.handle_process}})]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",prop:"department_no",label:t.$t("备注")},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"custom-table-popover"}},[o("div",{staticClass:"text-center"},[o("span",[t._v(t._s(e.row.des?e.row.des:"--"))])]),t._v(" "),o("div",{staticClass:"name-wrapper moon-content-text-ellipsis-class",attrs:{slot:"reference"},slot:"reference"},[o("span",[t._v(t._s(e.row.des?e.row.des:"--"))])])])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",prop:"department_no",label:t.$t("状态")},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.enable?o("span",{staticClass:"color-success"},[t._v(t._s(t.$t("启用")))]):o("span",{staticClass:"color-warning"},[t._v(t._s(t.$t("禁用")))])]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("i",{staticClass:"fa fa-edit color-grand margin-right-5",on:{click:function(o){return t.editInfo(e.row)}}}),t._v(" "),o("i",{staticClass:"fa fa-trash color-danger",on:{click:function(o){return t.deleteInfo(e.row)}}})]}}])})],1),t._v(" "),o("div",{staticClass:"layout-right-footer text-right"},[o("my-pagination",{staticClass:"layout-pagination",attrs:{total:t.total,"current-page":t.page,"page-size":t.num},on:{currentPage:t.currentPage,sizeChange:t.sizeChange,jumpChange:t.jumpPage}})],1)],1)],2),t._v(" "),o("drawer-layout-right",{attrs:{tabindex:"0","hide-footer":!1,visible:t.drawerVisible,size:"650px",title:t.$t("流程设置")},on:{changeDrawer:t.closeDrawerDialog,"right-close":t.cancelDrawDialog}},[o("div",{attrs:{slot:"content"},slot:"content"},[o("span",{attrs:{tabindex:"1"}}),t._v(" "),o("el-form",{ref:"form",attrs:{rules:t.rules,model:t.form,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"申请类型"}},[o("label",{staticClass:"color-success"},[t._v(t._s(t.$t("学生请假申请")))])]),t._v(" "),o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{staticClass:"width-300",model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"备注"}},[o("el-input",{staticClass:"width-300",model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"条件"}},[o("el-button-group",[o("el-button",{attrs:{size:"small",type:"1"==t.form.conditionType?"primary":"default"},on:{click:function(e){return t.handleChange(1)}}},[t._v(t._s(t.$t("当日假")))]),t._v(" "),o("el-button",{attrs:{size:"small",type:"2"==t.form.conditionType?"primary":"default"},on:{click:function(e){return t.handleChange(2)}}},[t._v(t._s(t.$t("自定义时长")))])],1),t._v(" "),2==t.form.conditionType?o("span",[o("el-input",{staticStyle:{width:"80px"},attrs:{size:"small",placeholder:t.$t("天数")},model:{value:t.form.conditionDay1,callback:function(e){t.$set(t.form,"conditionDay1",e)},expression:"form.conditionDay1"}}),t._v("\n            -\n            "),o("el-input",{staticStyle:{width:"80px"},attrs:{size:"small",placeholder:t.$t("天数")},model:{value:t.form.conditionDay2,callback:function(e){t.$set(t.form,"conditionDay2",e)},expression:"form.conditionDay2"}})],1):t._e(),t._v(" "),o("div",{staticStyle:{"line-height":"20px"}},[o("span",{staticClass:"color-danger font-size-12"},[t._v(t._s(t.errorTips))])])],1),t._v(" "),o("el-form-item",{attrs:{label:"状态"}},[o("my-radio",{attrs:{"sel-value":t.form.status,label:!0},on:{change:function(e){return t.changeStatus(e,!0)}}},[t._v(t._s(t.$t("启用")))]),t._v(" "),o("my-radio",{attrs:{"sel-value":t.form.status,label:!1},on:{change:function(e){return t.changeStatus(e,!1)}}},[t._v(t._s(t.$t("禁用")))])],1),t._v(" "),o("el-form-item",{attrs:{label:"流程"}},[o("my-flow-process-list",{ref:"flowProcessRef",attrs:{"process-data":t.form.handleProcess,"width-style":"200"}})],1)],1)],1),t._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("div",{staticClass:"text-right padding-lr-10"},[o("el-button",{attrs:{size:"small"},on:{click:t.cancelDrawDialog}},[t._v(t._s(t.$t("取消")))]),t._v(" "),o("el-button",{attrs:{size:"small",type:"primary",loading:t.drawerLoading},on:{click:t.okDrawDialog}},[t._v(t._s(t.$t("发布")))])],1)])]),t._v(" "),o("my-normal-dialog",{attrs:{visible:t.visibleConfim,loading:t.dialogLoading,title:"提示",content:"确认需要删除该信息？",detail:t.subTitle},on:{"update:visible":function(e){t.visibleConfim=e},"ok-click":t.handleOkChange,"cancel-click":t.handleCancelChange,close:t.closeDialog}})],1)}),[],!1,null,"4c7d86af",null);e.default=component.exports;installComponents(component,{MyInputButton:o(1257).default,MyFlowType:o(1286).default,MyFlowCondition:o(1287).default,MyFlowProcess:o(1288).default,MyPagination:o(234).default,LayoutTb:o(1261).default,MyRadio:o(1269).default,MyFlowProcessList:o(1289).default,DrawerLayoutRight:o(236).default,MyNormalDialog:o(1260).default})}}]);